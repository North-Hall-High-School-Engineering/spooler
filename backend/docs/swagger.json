{
    "schemes": [
        "http"
    ],
    "swagger": "2.0",
    "info": {
        "description": "API for 3D print job management and authentication",
        "title": "Spooler API",
        "contact": {
            "name": "North Hall TSA",
            "email": "northhalltsa@gmail.com"
        },
        "version": "1.0"
    },
    "host": "localhost:8080",
    "basePath": "/",
    "paths": {
        "/bucket/{filename}": {
            "get": {
                "security": [
                    {
                        "Authenticated": []
                    }
                ],
                "description": "Download STL file by filename",
                "produces": [
                    "application/octet-stream"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "Download STL file from bucket",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Stored filename",
                        "name": "filename",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "File streamed"
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/me": {
            "get": {
                "security": [
                    {
                        "Authenticated": []
                    }
                ],
                "description": "Returns current user's info from JWT claims",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "user"
                ],
                "summary": "Get authenticated user info",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/me/prints": {
            "get": {
                "security": [
                    {
                        "Authenticated": []
                    }
                ],
                "description": "Get all print jobs for the logged-in user",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "List prints of the authenticated user",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/models.Print"
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/metadata": {
            "post": {
                "security": [
                    {
                        "Authenticated": []
                    }
                ],
                "description": "Upload STL file and get its metadata (dimensions, volume, etc)",
                "consumes": [
                    "multipart/form-data"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "Get metadata for an STL file",
                "parameters": [
                    {
                        "type": "file",
                        "description": "STL file",
                        "name": "file",
                        "in": "formData",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/otp/request": {
            "post": {
                "description": "Generate OTP and send to email",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Request a one-time passcode (OTP)",
                "parameters": [
                    {
                        "description": "Email address",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.RequestOTPRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/otp/verify": {
            "post": {
                "description": "Validate OTP and return JWT token with secure cookie",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Verify OTP and login",
                "parameters": [
                    {
                        "description": "Email and OTP code",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.VerifyOTPRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/prints/all": {
            "get": {
                "security": [
                    {
                        "Authenticated": []
                    },
                    {
                        "RoleAdmin": []
                    }
                ],
                "description": "List all print jobs in the system",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "Get all print jobs (admin only)",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/models.Print"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/prints/new": {
            "post": {
                "security": [
                    {
                        "Authenticated": []
                    }
                ],
                "description": "Upload STL with requested filament color and create a print job",
                "consumes": [
                    "multipart/form-data"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "Upload a new print job STL file",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Filament color",
                        "name": "requested_filament_color",
                        "in": "formData",
                        "required": true
                    },
                    {
                        "type": "file",
                        "description": "STL file to upload",
                        "name": "file",
                        "in": "formData",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/prints/{id}": {
            "delete": {
                "security": [
                    {
                        "Authenticated": []
                    },
                    {
                        "RoleAdmin": []
                    }
                ],
                "description": "Deletes print job by ID and its stored STL file",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "Delete a print job and file (admin only)",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Print ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "404": {
                        "description": "Not Found",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/prints/{id}/approve": {
            "post": {
                "security": [
                    {
                        "Authenticated": []
                    },
                    {
                        "RoleAdmin": []
                    }
                ],
                "description": "Approves print job by ID",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "Approve a print job (admin only)",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Print ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/prints/{id}/deny": {
            "post": {
                "security": [
                    {
                        "Authenticated": []
                    },
                    {
                        "RoleAdmin": []
                    }
                ],
                "description": "Denies print job by ID with a reason",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "Deny a print job (admin only)",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Print ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Denial reason",
                        "name": "denyPrintRequest",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.DenyPrintRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/prints/{id}/status": {
            "put": {
                "security": [
                    {
                        "Authenticated": []
                    },
                    {
                        "RoleAdmin": []
                    }
                ],
                "description": "Update print job status by ID (e.g. printing, completed, denied)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "prints"
                ],
                "summary": "Update the status of a print job (admin only)",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Print ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "New status",
                        "name": "updatePrintStatusRequest",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.UpdatePrintStatusRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/register": {
            "post": {
                "description": "Creates a new user account",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "auth"
                ],
                "summary": "Register a new user account",
                "parameters": [
                    {
                        "description": "User registration payload",
                        "name": "registerRequest",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/handlers.RegisterRequest"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Created",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "handlers.DenyPrintRequest": {
            "type": "object",
            "required": [
                "reason"
            ],
            "properties": {
                "reason": {
                    "type": "string"
                }
            }
        },
        "handlers.RegisterRequest": {
            "type": "object",
            "required": [
                "email",
                "first_name",
                "last_name"
            ],
            "properties": {
                "email": {
                    "type": "string"
                },
                "first_name": {
                    "type": "string"
                },
                "last_name": {
                    "type": "string"
                }
            }
        },
        "handlers.RequestOTPRequest": {
            "type": "object",
            "required": [
                "email"
            ],
            "properties": {
                "email": {
                    "type": "string"
                }
            }
        },
        "handlers.UpdatePrintStatusRequest": {
            "type": "object",
            "required": [
                "status"
            ],
            "properties": {
                "status": {
                    "type": "string"
                }
            }
        },
        "handlers.VerifyOTPRequest": {
            "type": "object",
            "required": [
                "code",
                "email"
            ],
            "properties": {
                "code": {
                    "type": "string"
                },
                "email": {
                    "type": "string"
                }
            }
        },
        "models.Print": {
            "type": "object",
            "properties": {
                "createdAt": {
                    "type": "string"
                },
                "denialReason": {
                    "type": "string"
                },
                "id": {
                    "type": "integer"
                },
                "progress": {
                    "type": "integer"
                },
                "requestedFilamentColor": {
                    "type": "string"
                },
                "status": {
                    "$ref": "#/definitions/models.PrintStatus"
                },
                "storedFileName": {
                    "type": "string"
                },
                "updatedAt": {
                    "type": "string"
                },
                "uploadedFileName": {
                    "type": "string"
                },
                "userID": {
                    "type": "integer"
                }
            }
        },
        "models.PrintStatus": {
            "type": "string",
            "enum": [
                "approval_pending",
                "pending_print",
                "printing",
                "denied",
                "completed",
                "failed",
                "canceled",
                "paused"
            ],
            "x-enum-varnames": [
                "StatusApprovalPending",
                "StatusPendingPrint",
                "StatusPrinting",
                "StatusDenied",
                "StatusCompleted",
                "StatusFailed",
                "StatusCanceled",
                "StatusPaused"
            ]
        }
    },
    "securityDefinitions": {
        "Authenticated": {
            "type": "apiKey",
            "name": "token",
            "in": "cookie"
        },
        "RoleAdmin": {
            "type": "apiKey",
            "name": "token",
            "in": "cookie"
        }
    }
}